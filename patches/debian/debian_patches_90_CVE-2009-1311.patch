Fix POST data sent to wrong site when saving web page with embedded frame (CVE-2009-1311) (MFSA 2009-21)
https://bugzilla.mozilla.org/show_bug.cgi?id=471962
--- a/mozilla/toolkit/content/contentAreaUtils.js
+++ b/mozilla/toolkit/content/contentAreaUtils.js
@@ -334,7 +334,7 @@ function internalSave(aURL, aDocument, a
                    saveAsType == kSaveAsType_Text) ?
                    "text/plain" : aContentType,
     target      : fileURL,
-    postData    : isDocument ? getPostData() : null,
+    postData    : isDocument ? getPostData(aDocument) : null,
     bypassCache : aShouldBypassCache
   };
 
@@ -708,10 +708,13 @@ function appendFiltersForContentType(aFi
 }
 
 
-function getPostData()
+function getPostData(aDocument)
 {
   try {
-    var sessionHistory = getWebNavigation().sessionHistory;
+    var sessionHistory = aDocument.defaultView
+                                  .QueryInterface(Components.interfaces.nsIInterfaceRequestor)
+                                  .getInterface(Components.interfaces.nsIWebNavigation)
+                                  .sessionHistory;
     var entry = sessionHistory.getEntryAtIndex(sessionHistory.index, false);
     entry = entry.QueryInterface(Components.interfaces.nsISHEntry);
     return entry.postData;
